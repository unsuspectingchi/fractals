import{L as e,F as t,i as o,h as r,U as n,B as s,C as i,ai as a,aj as d,a1 as c,ak as l,al as u,a0 as h,am as f,k as m,D as p,ag as g,G as y}from"./three-BZ6b_Rf7.js";import{G as w,O as b}from"./vendor-Cx0zTeyC.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".menu-tab"),t=document.getElementById("loading-container"),o=document.getElementById("loading-text");e.forEach((r=>{r.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),r.classList.add("active");const n=r.dataset.fractal;o.textContent=`Loading ${n}...`,t.style.display="block";const s=new CustomEvent("fractalChange",{detail:{type:n}});window.dispatchEvent(s)}))}))}));const k=new WeakMap;function L(){let e,t;function o(e,t,o,r,n,s){const i=s.num_components(),a=o.num_points()*i,d=a*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),l=e._malloc(d);t.GetAttributeDataArrayForAllPoints(o,s,c,d,l);const u=new n(e.HEAPF32.buffer,l,a).slice();return e._free(l),{name:r,array:u,itemSize:i}}onmessage=function(r){const n=r.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const r=n.buffer,s=n.taskConfig;t.then((e=>{const t=e.draco,i=new t.Decoder;try{const e=function(e,t,r,n){const s=n.attributeIDs,i=n.attributeTypes;let a,d;const c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,d=t.DecodeArrayToMesh(r,r.byteLength,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,d=t.DecodeArrayToPointCloud(r,r.byteLength,a)}if(!d.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const l={index:null,attributes:[]};for(const u in s){const r=self[i[u]];let d,c;if(n.useUniqueIDs)c=s[u],d=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[s[u]]),-1===c)continue;d=t.GetAttribute(a,c)}const h=o(e,t,a,u,r,d);"color"===u&&(h.vertexColorSpace=n.vertexColorSpace),l.attributes.push(h)}c===e.TRIANGULAR_MESH&&(l.index=function(e,t,o){const r=o.num_faces(),n=3*r,s=4*n,i=e._malloc(s);t.GetTrianglesUInt32Array(o,s,i);const a=new Uint32Array(e.HEAPF32.buffer,i,n).slice();return e._free(i),{array:a,itemSize:1}}(e,t,a));return e.destroy(a),l}(t,i,new Int8Array(r),s),a=e.attributes.map((e=>e.array.buffer));e.index&&a.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},a)}catch(a){console.error(a),self.postMessage({type:"error",id:n.id,error:a.message})}finally{t.destroy(i)}}))}}}if(console.log("main.js starting execution..."),void 0===a)throw console.error("THREE is not defined in main.js!"),new Error("THREE is not defined");console.log("THREE is defined in main.js, proceeding with initialization...");const E=new d;E.background=new i(0);const _=new c(75,window.innerWidth/window.innerHeight,.1,1e3);_.position.z=5;const x=new l({antialias:!1,powerPreference:"high-performance",precision:"mediump"});x.setSize(window.innerWidth,window.innerHeight),x.setPixelRatio(Math.min(window.devicePixelRatio,2)),x.shadowMap.enabled=!1,document.body.appendChild(x.domElement);const A=new u;A.onProgress=(e,t,o)=>{const r=t/o*100,n=document.getElementById("loading-progress"),s=document.getElementById("loading-text");n.style.width=r+"%",s.textContent=Math.round(r)+"%"},A.onLoad=()=>{document.getElementById("loading-container").style.display="none"},A.onError=e=>{console.error(`Error loading: ${e}`);const t=document.getElementById("loading-text");t.textContent="Error loading model!",t.style.color="#ff4444"};const C=new w(A),D=new class extends e{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,o,r,n){const s=new t(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{this.parse(e,o,n)}),r,n)}parse(e,t,r=()=>{}){this.decodeDracoFile(e,t,null,null,o).catch(r)}decodeDracoFile(e,t,o,n,s=r,i=()=>{}){const a={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!o,vertexColorSpace:s};return this.decodeGeometry(e,a).then(t).catch(i)}decodeGeometry(e,t){const o=JSON.stringify(t);if(k.has(e)){const t=k.get(e);if(t.key===o)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const n=this.workerNextTaskID++,s=e.byteLength,i=this._getWorker(n,s).then((o=>(r=o,new Promise(((o,s)=>{r._callbacks[n]={resolve:o,reject:s},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return i.catch((()=>!0)).then((()=>{r&&n&&this._releaseTask(r,n)})),k.set(e,{key:o,promise:i}),i}_createGeometry(e){const t=new n;e.index&&t.setIndex(new s(e.index.array,1));for(let o=0;o<e.attributes.length;o++){const r=e.attributes[o],n=r.name,i=r.array,a=r.itemSize,d=new s(i,a);"color"===n&&(this._assignVertexColorSpace(d,r.vertexColorSpace),d.normalized=i instanceof Float32Array==!1),t.setAttribute(n,d)}return t}_assignVertexColorSpace(e,t){if(t!==o)return;const r=new i;for(let o=0,n=e.count;o<n;o++)r.fromBufferAttribute(e,o).convertSRGBToLinear(),e.setXYZ(o,r.r,r.g,r.b)}_loadLibrary(e,o){const r=new t(this.manager);return r.setPath(this.decoderPath),r.setResponseType(o),r.setWithCredentials(this.withCredentials),new Promise(((t,o)=>{r.load(e,t,void 0,o)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const o=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const r=L.toString(),n=["/* draco decoder */",o,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const o=t.data;switch(o.type){case"decode":e._callbacks[o.id].resolve(o);break;case"error":e._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[e]=t,o._taskLoad+=t,o}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};D.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),C.setDRACOLoader(D);const v=new h;E.add(v);let P=null,T=0,I="menger";const R=new f(16777215,2);E.add(R);const S=new m(4286945,4,8);S.position.set(0,0,0),E.add(S);const M=new p(16777215,3);M.position.set(3,3,3),E.add(M);const U=new p(4286945,2.5);U.position.set(-3,-2,2),E.add(U);const O=new p(16777215,2);O.position.set(0,0,-3),E.add(O);const z=new m(16777215,5,10);z.position.set(0,0,0),E.add(z),z.visible=!1;const B=new p(4286945,2);B.position.set(0,5,0),E.add(B),B.visible=!1;const F=new b(_,x.domElement);function N(e){if("sierpinski"===e){const e=3.32;F.minDistance=1.5*e,F.maxDistance=15}else{const e=2;F.minDistance=e*Math.sqrt(3)/2+.1,F.maxDistance=10}F.target.set(0,0,0),F.update()}function j(e){!function(){for(;v.children.length>0;){const e=v.children[0];e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach((e=>e.dispose())):e.material.dispose()),v.remove(e)}}(),I=e,N(e),function(e){"sierpinski"===e?(z.visible=!0,B.visible=!0,S.visible=!1,M.visible=!1,U.visible=!1,O.visible=!1,R.intensity=1):(S.visible=!0,M.visible=!0,U.visible=!0,O.visible=!0,z.visible=!1,B.visible=!1,R.intensity=1.5)}(e);const t=document.getElementById("loading-progress"),o=document.getElementById("loading-text"),r=document.getElementById("loading-container");t.style.width="0%",o.textContent="0%",o.style.color="#ffffff",r.style.display="block";const n="sierpinski"===e?"/fractals/models/sierpinski-compressed.glb":"/fractals/models/menger_sponge-compressed.glb";console.log(`Attempting to load model from: ${n}`),console.log("Resolved model path:",new URL(n,window.location.href).href),A.onStart=(e,t,o)=>{console.log(`Started loading: ${e}`)},A.onProgress=(e,r,n)=>{const s=r/n*100;console.log(`Loading progress: ${s.toFixed(2)}%`),t.style.width=s+"%",o.textContent=Math.round(s)+"%"},A.onLoad=()=>{console.log("Loading complete!"),r.style.display="none"},A.onError=e=>{console.error(`Error loading: ${e}`),o.textContent="Error loading model!",o.style.color="#ff4444"},C.load(n,(t=>{console.log(`Model loaded successfully: ${n}`);const o=t.scene;P=o;const s=(new g).setFromObject(o);let i;T=Math.max(s.max.x-s.min.x,s.max.y-s.min.y,s.max.z-s.min.z),"sierpinski"===e?(i=function(e){const t=new h,o=.83*e,r=-.664;return[{x:-1.66,y:r,z:-1.66},{x:o/2,y:r,z:-1.66},{x:o/2,y:r,z:o/2},{x:-1.66,y:r,z:o/2},{x:0,y:o+r,z:0}].forEach((e=>{const o=P.clone();if(o.position.set(e.x,e.y,e.z),"sierpinski"===I){const e=new m(16777215,2,3);e.position.set(0,0,0),o.add(e)}t.add(o)})),t}(4),_.position.set(8,8,8)):(i=function(e,t){const o=new h,r=new y({color:4286945,metalness:.7,roughness:.2,transparent:!0,opacity:1,flatShading:!0});return function e(t,n,s,i,a){if(0===a){const e=P.clone();return e.scale.setScalar(i/T),e.position.set(t,n,s),e.traverse((e=>{e.isMesh&&(e.material=r)})),void o.add(e)}const d=i/3;for(let o=-1;o<=1;o++)for(let r=-1;r<=1;r++)for(let i=-1;i<=1;i++)Math.abs(o)+Math.abs(r)+Math.abs(i)<=1||e(t+o*d,n+r*d,s+i*d,d,a-1)}(0,0,0,t,e),o}(1,2),_.position.set(0,0,5)),v.add(i),F.target.set(0,0,0),F.update(),r.style.display="none"}),(e=>{if(e.lengthComputable){const r=e.loaded/e.total*100;console.log(`Download progress: ${r.toFixed(2)}%`),t.style.width=r+"%",o.textContent=Math.round(r)+"%"}}),(e=>{console.error("An error happened:",e),o.textContent="Error loading model!",o.style.color="#ff4444"}))}F.enableDamping=!0,F.dampingFactor=.1,F.rotateSpeed=.7,F.zoomSpeed=.7,F.enablePan=!1,window.addEventListener("fractalChange",(e=>{j(e.detail.type)})),N("menger");let G=0;!function e(t){requestAnimationFrame(e);const o=t-G;G=t,o>16&&"sierpinski"!==I&&(v.rotation.x+=.001,v.rotation.y+=.001),F.enabled&&F.update(),x.render(E,_)}(performance.now()),window.addEventListener("resize",(()=>{const e=window.innerWidth,t=window.innerHeight;_.aspect=e/t,_.updateProjectionMatrix(),x.setSize(e,t)}));
//# sourceMappingURL=index-Dr9kFq9_.js.map
